<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Contact - Blood Sugar Monitor Clinic</title>
  <link rel="stylesheet" href="css/style.css" />

  <!-- Internal CSS for Contact Page -->
  <style>
    /* ================================
       Emergency Banner
       ================================ */
    .emergency-banner {
      background-color: #ffdddd; /* Light red background for visibility */
      color: #800000; /* Dark red text */
      padding: 10px 15px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 1rem;
      border-bottom: 2px solid #cc0000;
    }
    .emergency-banner i {
      margin-right: 8px;
      font-size: 1.2rem;
    }
    .close-btn {
      background: none;
      border: none;
      font-size: 1.2rem;
      cursor: pointer;
      color: #800000;
      font-weight: bold;
    }

    /* ================================
       Contact Content Container
       ================================ */
    .contact-container {
      max-width: 900px;
      margin: 40px auto;
      background: #f8fcff; /* Very light blue background */
      border-radius: 12px;
      padding: 30px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    h2 {
      color: #004080; /* Clinic blue */
      margin-bottom: 15px;
      text-align: center;
    }

    /* ================================
       Important Update Section
       ================================ */
    .update-section {
      background: #e6f2ff; /* Slightly darker light blue */
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 20px;
      font-size: 1rem;
    }

    /* ================================
       Appointment Request Section
       ================================ */
    .appointment-section {
      background: #f0f7ff; /* Very light blue */
      padding: 20px;
      border-radius: 10px;
      text-align: center;
    }

    .appointment-section img {
      width: 80px;
      margin: 10px 0;
    }

    .appointment-section p {
      margin-bottom: 10px;
      line-height: 1.5;
    }

    .buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 20px;
    }

    .buttons button {
      padding: 10px 20px;
      font-size: 1rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      color: white;
    }

    .back-btn {
      background-color: #6b93c0;
    }

    .start-btn {
      background-color: #4a90e2;
    }

    /* ================================
       Footer Section
       ================================ */
    footer {
      margin-top: 50px;
      background-color: #dfeaf5;
      padding: 20px;
      text-align: center;
      font-size: 0.9rem;
      line-height: 1.5;
      color: #003366;
    }

    footer a {
      color: #004080;
      text-decoration: none;
      margin: 0 5px;
    }

    footer a:hover {
      text-decoration: underline;
    }
    /* Contact form styles */
    .contact-form { max-width:760px; margin-top:18px; background:#ffffff;padding:18px;border-radius:10px;border:1px solid #e6eefc; }
    .contact-form .form-input { width:100%; max-width:100%; padding:8px;border-radius:6px;border:1px solid #ccc; box-sizing:border-box; }
    .contact-form .actions { display:flex; gap:10px; align-items:center; }
  </style>

  <script>
    // Close the emergency banner
    function closeBanner() {
      document.querySelector('.emergency-banner').style.display = 'none';
    }
  </script>
</head>
<body>

  <!-- ================================
       Emergency Banner
       ================================ -->
  <div class="emergency-banner">
    <div>
      <i>⚠️</i>
      <strong>Emergency:</strong> If this is an emergency, please call <strong>911</strong> or go to your nearest emergency department.
    </div>
    <button class="close-btn" onclick="closeBanner()">×</button>
  </div>

  <!-- ================================
       Navigation Header
       ================================ -->
  <header>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="patient.html">Patient</a></li>
        <li><a href="specialist.html">Specialist</a></li>
        <li><a href="clinic.html">Clinic</a></li>
        <li><a href="contact.html" class="active">Contact Us</a></li>
      </ul>
    </nav>
  </header>

  <!-- ================================
       Main Contact Content
       ================================ -->
  <main>
    <div class="contact-container">
      <h2>Contact & Appointments</h2>

      <!-- Important Updates Section -->
      <div class="update-section">
        <strong>Important Update:</strong> Our clinic celebrates 100 years of compassionate care.  
        For urgent assistance, call <strong>800.223.2273</strong> or visit our <a href="#">Help Center</a>.
      </div>
      <!-- Contact Form -->
      <div class="update-section" style="margin-top:12px">
        <strong>Contact Form:</strong> Use the form below for non-urgent questions. Staff will review messages and reply as appropriate. For urgent matters, please call the clinic directly.
      </div>

      <div class="contact-form" style="margin-top:18px;background:#ffffff;padding:18px;border-radius:10px;border:1px solid #e6eefc;">
        <form id="contactForm">
          <div style="display:flex;gap:12px;flex-wrap:wrap;">
            <div style="flex:1;min-width:200px">
              <label for="contact-name">Your name</label>
              <input id="contact-name" name="name" type="text" required class="form-input" />
            </div>
            <div style="flex:1;min-width:200px">
              <label for="contact-email">Your email</label>
              <input id="contact-email" name="email" type="email" required class="form-input" />
            </div>
          </div>

          <div style="margin-top:12px">
            <label for="contact-subject">Subject</label>
            <input id="contact-subject" name="subject" type="text" required class="form-input" />
          </div>

          <div style="margin-top:12px">
            <label for="contact-message">Message</label>
            <textarea id="contact-message" name="message" rows="6" required class="form-input" style="min-height:140px"></textarea>
          </div>

          <div class="actions">
            <button type="submit" style="background:#004080;color:#fff;border:none;padding:10px 14px;border-radius:6px;cursor:pointer">Send Message</button>
            <button id="contactClear" type="button" style="background:#f0f0f0;border:1px solid #ccc;padding:8px 12px;border-radius:6px;cursor:pointer">Clear</button>
            <span id="contactStatus" style="margin-left:8px;color:#333"></span>
          </div>
        </form>
      </div>

      <script>
        (function(){
          const form = document.getElementById('contactForm');
          const statusEl = document.getElementById('contactStatus');
          const clearBtn = document.getElementById('contactClear');

          function pushToLocalStorage(msg) {
            try {
              const raw = localStorage.getItem('contact_messages') || '[]';
              const arr = JSON.parse(raw);
              arr.push(msg);
              localStorage.setItem('contact_messages', JSON.stringify(arr));
              return true;
            } catch (e) { console.warn('Failed to persist contact message locally', e); return false; }
          }

          async function trySendToServer(msg) {
            // Best-effort: attempt to POST to a contact API endpoint if available.
            // If server rejects or endpoint missing, we keep the local copy.
            try {
              const res = await fetch('/api/contact', {
                method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(msg)
              });
              if (res.ok) return true;
              // Try alternative generic notify endpoint if defined in backend
              const alt = await fetch('/api/notify/email', {
                method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ to: 'staff@clinic', subject: msg.subject, message: msg.message })
              });
              return alt.ok;
            } catch (e) {
              console.warn('Contact: server send failed', e);
              return false;
            }
          }

          form.addEventListener('submit', async function(ev){
            ev.preventDefault();
            statusEl.textContent = '';
            const msg = {
              id: Date.now(),
              name: document.getElementById('contact-name').value.trim(),
              email: document.getElementById('contact-email').value.trim(),
              subject: document.getElementById('contact-subject').value.trim(),
              message: document.getElementById('contact-message').value.trim(),
              created_at: new Date().toISOString()
            };

            // persist locally first
            const okLocal = pushToLocalStorage(msg);
            if (!okLocal) {
              statusEl.style.color = 'red'; statusEl.textContent = 'Could not save message locally.'; return;
            }

            // optimistic UI — always display 'Message sent' to the end user
            statusEl.style.color = '#444'; statusEl.textContent = 'Saved locally.';

            // try send to server (best-effort)
            const sent = await trySendToServer(msg).catch(()=>false);
            if (sent) {
              statusEl.style.color = 'green'; statusEl.textContent = 'Message sent.';
            } else {
              // still show 'Message sent' to the user but mark queued state visually
              statusEl.style.color = 'orange'; statusEl.textContent = 'Message sent.';
            }

            // also mark pending outbox and push a lightweight notify so staff dashboard shows an alert
            try {
              const notify = { id: msg.id, summary: `${msg.name} — ${msg.subject}`, created_at: msg.created_at };
              localStorage.setItem('pending_outbox_notify', JSON.stringify(notify));
              // also ensure a pending_emails queue has an entry so dashboard can count it
              const pending = JSON.parse(localStorage.getItem('pending_emails') || '[]');
              pending.push({ id: msg.id, to: 'staff@clinic', subject: `Contact: ${msg.subject}`, message: msg.message, meta: { from: msg.email, name: msg.name }, created_at: msg.created_at });
              localStorage.setItem('pending_emails', JSON.stringify(pending));
            } catch (e) { console.warn('Failed to set pending outbox notify', e); }

            // link to open staff dashboard removed — notify is set but no user-facing link

            // reset form after short delay
            setTimeout(()=>{ form.reset(); }, 300);
            // notify dashboard (if open) via storage event - already handled by polling on dashboard
          });

          clearBtn.addEventListener('click', ()=>{ form.reset(); statusEl.textContent=''; });
        })();
      </script>
    </div>
  </main>

  <!-- ================================
       Footer
       ================================ -->
  <footer>
    <p>
      <strong>Blood Sugar Monitor Clinic</strong> — Inspired by 100 years of excellence.<br>
      9500 Euclid Avenue, Cleveland, Ohio 44195 | 800.223.2273
    </p>
    <p>
      <a href="#">Appointments</a> | 
      <a href="#">Financial Assistance</a> | 
      <a href="#">News</a> | 
      <a href="#">Privacy Policy</a>
    </p>
    <p>© 2025 Blood Sugar Monitor Clinic. All Rights Reserved.</p>
  </footer>

</body>
</html>
